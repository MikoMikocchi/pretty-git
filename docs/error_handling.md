# Обработка ошибок и коды возврата

Статус: Draft

## Коды возврата
- 0 — успех
- 1 — ошибка пользователя (неверные флаги, несовместимые опции, неизвестный отчёт/формат)
- 2 — системная ошибка (ошибка git, IO и т.п.)

## Сообщения об ошибках
- Чёткие и actionable, с подсказкой по `--help`.
- Валидация несовместимых флагов на уровне CLI.

## Категории ошибок
- UserInput: невалидные флаги/комбинации, неправильные значения, отсутствующие аргументы → exit 1.
- NotFound: отсутствует репозиторий/путь, отсутствуют файлы → exit 1 (для входных аргументов).
- External: ошибки `git` (非0 exit), недоступность репозитория → exit 2.
- IO/Encoding: ошибки чтения/записи/кодировок → exit 2.
- Internal: неожиданные исключения → exit 2, дружелюбное сообщение и просьба создать issue.

## Матрица ошибок (детально)
- Неизвестный отчёт → 1, stderr: "Unknown report '<name>'. See --help for the list of reports.".
- Неизвестный формат → 1, stderr: "Unknown format '<fmt>'. See --help --formats.".
- Несовместимые флаги (пример: `--time-bucket` не для `authors`) → 1, stderr: объяснение + пример корректного использования.
- Пустой результат фильтров → 0, stdout: корректный пустой отчёт; stderr: нет.
- Репозиторий не найден → 1, stderr: "Repository not found at '<path>'".
- Ошибка git (exit != 0) → 2, stderr: кратко + хвост stdout/stderr git при `--verbose`.
- Ошибка чтения/записи файла `--out` → 2, stderr: системная ошибка с путём.
- Ошибка кодировки ввода/вывода → 2, stderr: рекомендация выставить UTF-8 locale.
- Неизвестная внутренняя ошибка → 2, stderr: просьба приложить версию и команду, ссылка на Issues.

## Политика stdout/stderr
- Структурные отчёты (JSON/YAML/XML/CSV/MD/console) → в stdout.
- Сообщения об ошибках/предупреждения/деприкации → в stderr.
- `--verbose` включает дополнительные детали (время, параметры, хвост вывода git).

## Советы по исправлению (remediation)
- Печать ближайших совпадений/подсказок по опечаткам для отчётов/форматов.
- Для несовместимых флагов — печатать матрицу допустимых комбинаций (см. `docs/cli_help.md`).
- При ошибках git — рекомендовать проверить ветку/права доступа/наличие git.

## Отчётность тестов
- Карта категорий ошибок → JUnit-style testcase names для CI-агрегации.
- Покрыть property-based генераторами некорректных флагов/значений (см. `docs/testing.md`).

## Матрица ошибок (набросок)
- Неизвестный отчёт → 1
- Неизвестный формат → 1
- Не найден репозиторий/git error → 2
