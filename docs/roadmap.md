# Дорожная карта версий (Roadmap)

Версия: 0.2
Статус: Draft (внутренний документ)

## Принципы
- Следуем SemVer: PATCH — исправления/полировка; MINOR — совместимые улучшения/фичи; MAJOR — несовместимые изменения.
- Spec‑Driven: перед реализацией обновляем спецификации и ADR.
- Детерминизм вывода и стабильность CLI — приоритет.

## Эпики (направления)
- Производительность и масштабируемость: потоковая обработка, буферизация, снижение аллокаций, параллельные вычисления.
- Надёжность и предсказуемость: детерминизм, стабильные сортировки, схемы/валидации для форматов.
- Расширяемость: плагины экспортёров/рендеров/провайдеров данных, конфиг‑файл.
- Новые аналитические отчёты: hotspots, churn, ownership, coupling, trends.
- Интеграции: Homebrew, DevOps‑пайплайны, опциональные API (GitHub/GitLab) — строго opt‑in.

## 0.1.x — Стабилизация
- Исправления багов и UX‑полировка консоли (выравнивание, переносы, подсветка максимумов, `--theme`).
- Улучшения производительности на больших репозиториях (профилирование, уменьшение аллокаций, буферизация IO).
- Интеграционные тесты для Homebrew tap (smoke в отдельном job).
- Расширение карты языков (поддержка редких расширений), дополнительные исключения директорий.

## 0.2.x — Stabilization & DX
- Детерминизм: единые правила сортировки и тайбрейков во всех отчётах; интеграционные тесты стабильности выводов.
- Производительность: целевые бюджеты времени на X коммитов/файлов; профилирование узких мест; безопасный parallel по чанкам.
- Кэширование: инвалидация по `HEAD` и фильтрам; настраиваемый TTL; отключаемость.
- Кроссплатформенность: пути Windows/WSL, CRLF, кодировки; большие репозитории и долгие пути.
- Временные зоны/локали: единый формат времени во всех форматах экспорта.
- CLI UX: явные сообщения об ошибках и валидации несовместимых флагов; улучшенный `--help`.
- Release hygiene: preflight‑проверки (Gemfile.lock frozen, соответствие версий, зелёный CI) перед тегом.

ADR:
- DR-020: Форматы данных и обратная совместимость (JSON Schema/XSD, политика изменений).
- DR-021: Политика детерминизма и тестирование стабильности.
- DR-022: Performance targets и эталонные бенчмарки.

## 0.2.0 — Производительность и инкрементальность
- Провайдер `Rugged` под флагом (ADR: критерии выбора, fallback на git CLI).
- Инкрементальный режим: анализ только новых коммитов (state в файле/ключе; hash HEAD/метки времени).
- Параллельные агрегации там, где безопасно (по чанкам коммитов/файлам).
- Кэширование промежуточных результатов (опционально, TTL/инвалидация по HEAD и фильтрам).

ADR:
- DR-012: Политика инкрементального анализа и хранения state.
- DR-013: Критерии выбора провайдера (CLI vs Rugged), стратегия fallback.

## 0.3.0 — Новые отчёты и метрики кода
- Отчёт "hotspots": частота изменений × размер диффов (risk map).
- Отчёт "churn": изменчивость по файлам/папкам за период (rolling window).
- Отчёт "ownership" (владение): доля вклада по файлам (по коммитам/строкам) — best‑effort.
- Отчёт "coupling": файлы, часто меняющиеся вместе (pair change frequency).
- Тренды: `activity`/`authors` по скользящим окнам (4/12 недель).

ADR:
- DR-014: Методики вычисления hotspots и churn (пороговые значения, нормализация).
- DR-015: Подход к ownership и ограничения (heuristics).

## 0.4.0 — Плагины, конфиг и расширяемость
- Плагинная система для экспортёров/рендеров/провайдеров (интерфейсы, загрузка по имени класса/gem).
- Конфиг‑файл `.prettygit.yml`: значения по умолчанию для флагов, пресеты отчётов.
- Улучшение UX: генерация автодополнений (bash/zsh/fish), подкоманды, preset‑команды.

ADR:
- DR-016: Контракт плагинов и безопасность загрузки.
- DR-017: Формат `.prettygit.yml` и приоритеты источников конфигурации.

## 0.5.0 — Интеграции и форматы
- Экспортёры: NDJSON/Parquet (исследование пригодности; возможно через плагины).
- Отчёты в HTML (статические): красивые интерактивные страницы (без сервера) — экспорт одного архива.
- Интеграции: опциональные GitHub/GitLab API для обогащения (PR/Review метрики), строго opt‑in и с rate‑limit.

ADR:
- DR-018: HTML‑экспорт и политика фронтовой сборки (без зависимостей на рантайме).
- DR-019: Политика опциональных внешних API и секретов.

## Возможные MAJOR (1.0.0)
- Контракты форматов (JSON Schema, XSD) и их валидация в CI.
- Гарантии стабильности CLI/форматов, migration guide.
- Совместимость 0.x → 1.0.0 (deprecated‑период и удаления).

## KPI/метрики качества
- Time‑to‑report на репозитории 100k коммитов: −30% к 0.2.0, −50% к 0.3.0.
- Покрытие тестами критических путей (агрегации/рендеры) ≥ 90%.
- Zero‑regression policy: детерминизм результатов на фиксированных фикстурах.

## Риски и смягчение
- Ограничения git CLI и производительность: фоллбек на Rugged, буферизация, ленивые итераторы.
- Поддержка Windows: отдельные тесты и best‑effort гайды, `--no-color`/квотирование путей.
- Изменения Homebrew API: автоматические тесты формулы и ручная проверка перед слиянием.

## Зависимости и внешние решения
- Ruby >= 3.4.
- `csv`, `rexml` — поддерживаются и обновляются с учётом совместимости.

## Процесс планирования
- Каждая MINOR сопровождается ADR‑пакетом и обновлением спецификаций.
- До релиза — чек‑листы `docs/release.md` и smoke‑тесты.
