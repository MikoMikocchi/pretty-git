# Заметки по аналитике

Статус: Draft

## Hotspots (скоринг)
- Комбинация частоты и масштаба изменений; нормализация; сортировка по score desc, тайбрейки.

### Формальное определение
- Пусть для файла i за период P: `commits_i`, `additions_i`, `deletions_i`, `changes_i = additions_i + deletions_i`.
- Базовый скоринг v1: `score_i = commits_i * changes_i`.
- Нормализация (опционально для визуализации): `score'_i = (score_i - min) / (max - min)` при `max > min` иначе 0.
- Сортировка: по `score desc`, затем `commits desc`, затем `changes desc`, затем `path asc`.

### Инварианты
- Если добавлять коммиты/изменения к файлу i, его `score` не убывает.
- Для равных `score` порядок стабилен согласно тай-брейкам.

## Churn
- Сумма изменений по файлу с учетом частоты, сортировка по churn desc.

### Формальное определение
- `churn_i = additions_i + deletions_i`.
- Сортировка: `churn desc`, затем `commits desc`, затем `path asc`.

### Инварианты
- `churn_i >= 0`.
- `sum(churn_i)` по множеству файлов = сумма абсолютных изменений за период.

## Ownership
- Доля правок основного автора; поля: `owner`, `owner_share`, `authors`.

### Формальное определение
- Пусть множество авторов A. Для автора a: `contrib_a` — вклад (коммиты или строки по стратегии).
- `owner = argmax_a(contrib_a)`, `owner_share = contrib_owner / sum_a(contrib_a) * 100`.
- `authors = |{a in A | contrib_a > 0}|`.

### Инварианты/ограничения
- `0 <= owner_share <= 100`. Сумма долей авторов ≈ 100% с допустимой погрешностью округления.
- Файлы с генерируемым содержимым/большими артефактами могут исключаться из расчёта.
- Без построчного blame точность ограничена агрегацией по diff‑статистике.

## Ограничения/краевые кейсы
- Бинарные файлы/папки‑исключения; большие JSON‑данные; модули‑генераторы.

## Ссылки на тесты
- `spec/analytics/*_spec.rb`
