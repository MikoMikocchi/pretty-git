# Требования: Pretty Git — Генератор отчётов по Git

> Статус (на текущее состояние репозитория):
> - [x] CLI каркас, `--help`, `--version`, базовая валидация
> - [x] Фильтры: `--repo`, `--branch`, `--author`, `--exclude-author`, `--path`, `--exclude-path`
> - [x] Отчёты: `summary`, `authors`
> - [x] Вывод: `console`, `json`, поддержка `--out`
> - [x] Коды возврата: 0/1/2
> - [x] Отчёты: `activity`, `files`, `heatmap`
> - [x] Новые отчёты: `hotspots`, `churn`, `ownership`
> - [x] Экспорты: `csv`, `md`, `yaml`, `xml`
> - [x] Интеграционные проверки схем экспорта

Дата: 2025-08-12
Версия документа: 0.1 (draft)
Статус: Проектирование (Spec-Driven Development)

## 1. Цели и ценность
- Предоставить разработчикам и тимлидам быструю аналитику по локальным Git-репозиториям.
- Сформировать красивые, понятные и консистентные отчёты.
- Поддержать экспорт в несколько форматов и консольный вывод с подсветкой.

## 2. Область применения
- Анализ локальных Git-репозиториев (без сетевых запросов).
- Сценарии: сводка коммитов, статистика по авторам/файлам, активность по времени, фильтрация.

## 3. Пользовательские истории (high-level)
- Как разработчик, я хочу быстро увидеть сводку по репозиторию за период, чтобы оценить активность.
- Как тимлид, я хочу экспорт в JSON/CSV/Markdown/YAML/XML, чтобы интегрировать отчёты в пайплайны.
- Как аналитик, я хочу фильтровать по времени/авторам/веткам/папкам/типа изменений, чтобы получать релевантные данные.

## 4. Функциональные требования
- [x] Выбор репозитория: путь к локальному репозиторию (`--repo PATH` или текущая директория).
- [x] Фильтрация:
  - Время: `--since`, `--until` (ISO8601, "2 weeks ago" не обяз.).
  - Авторы: `--author`, `--exclude-author` (маска/регэксп не обяз. в v1).
  - [x] Ветки: `--branch` (одна/несколько), по умолчанию текущая.
  - [x] Пути: `--path`, `--exclude-path` (глоб-маски).
  - Типы изменений: добавления/удаления/модификации (по данным diff/numstat).
- Метрики и отчёты (минимум v1):
  - [x] Сводка репозитория: количество коммитов, авторов, период, топ-авторы, топ-файлы, строки +/-.
  - [x] Активность по времени: по дням/неделям/месяцам (гистограмма/таблица).
  - [x] По авторам: коммиты, строки +/- за период, средний размер коммита.
  - [x] По файлам/директориям: топ N по изменениям.
  - [x] Тепловая карта времени (час дня x день недели) — агрегированная таблица.
  - [x] Распределение по языкам репозитория (bytes|files|loc), проценты, лимит; экспорт во все форматы (см. `docs/output_formats.md`).
  - [x] Hotspots, Churn, Ownership — требования по полям/сортировке/экспортам заданы централизованно в `docs/output_formats.md` и ADR (`docs/decisions.md`).
- Вывод:
  - [x] Консоль: человекочитаемый, с цветами/таблицами.
  - [x] Экспорт: `--format json` (CSV/MD/YAML/XML реализованы; см. ADR). CSV — по правилам ADR DR-001 и схемам в `docs/output_formats.md`.
  - [x] Файл: `--out FILE` (stdout по умолчанию).
- Производительность:
  - Обработка средних репозиториев (до ~50k коммитов) без критичных задержек.
  - Потоковая обработка логов Git без загрузки всего в память, где возможно.

## 5. Нефункциональные требования
- Язык: Ruby >= 3.4.
- Совместимость: macOS/Linux; Windows — best‑effort (через Git Bash/WSL допустимо).
- Архитектура: SOLID, KISS, DRY. Чистая структура, разделение слоёв.
- Надёжность: корректная обработка не-репозиториев, пустых веток, нестандартных авторов.
- [x] Тестируемость: RSpec; покрытие ключевых компонентов парсинга/агрегации/форматирования.
- UX CLI: понятные ошибки, `--help`, версии, примеры.
 - Время/детерминизм/темы: см. `docs/determinism.md`, `docs/compatibility.md` и `docs/architecture.md` (ConsoleRenderer, темы и ширина терминала).

## 6. Ограничения и допущения
- Доступ только к локальному Git (используем `git` CLI или библиотеку Rugged — решение см. `data_model.md`).
- Не требуем сетевых ключей/доступов.
- Первичная реализация — read-only, без изменения репозитория.

## 7. Критерии приёмки (v1)
- CLI-команда `pretty-git` запускается из любой директории и корректно находит/валидирует репозиторий.
- Для указанного периода и фильтров генерируются все заявленные отчёты.
- Поддержаны форматы вывода: JSON, CSV, Markdown, YAML, XML; содержимое валидно. CSV соответствует DR-001 и схемам.
 - Для отчётов `hotspots`, `churn`, `ownership` форматы соответствуют схемам в `docs/output_formats.md`; порядок элементов детерминирован по `docs/determinism.md`.
- Консольный вывод структурирован, с цветами и чёткими заголовками.
- Ошибки и edge-cases обрабатываются с дружественными сообщениями и ненулевыми кодами возврата при фатальных ошибках.
 - Порядок элементов вывода детерминирован.

## 8. Out of scope (v1)
- Веб-UI, БД, интеграция с внешними API.
- Сложные регэкспы авторов/путей и продвинутые языковые фильтры.
- Интерактивный TUI.

## 9. Безопасность и приватность
- Не отправляет данные наружу. Обрабатывает только локально.
- Не хранит кэш по умолчанию (опционально в v2).

## 10. Документация
- `docs/decisions.md` (ADR), `requirements.md`, `tasks.md`, `cli_spec.md`, `output_formats.md`, `data_model.md` — первично.
- `README.md` — краткое описание и примеры запуска (после спецификаций).
